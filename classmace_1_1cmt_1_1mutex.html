<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>MACE: mace::cmt::mutex Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="style.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>


<script type="text/javascript">
  var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32339400-1']);
      _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                      })();

</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">MACE
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><b>mace</b>      </li>
      <li class="navelem"><a class="el" href="namespacemace_1_1cmt.html">cmt</a>      </li>
      <li class="navelem"><a class="el" href="classmace_1_1cmt_1_1mutex.html">mutex</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">mace::cmt::mutex Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>mutex  
 <a href="classmace_1_1cmt_1_1mutex.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="mutex_8hpp_source.html">mutex.hpp</a>&gt;</code></p>

<p><a href="classmace_1_1cmt_1_1mutex-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:afa222fe0b2ed055066c0a3016f035ee2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afa222fe0b2ed055066c0a3016f035ee2"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>try_lock</b> ()</td></tr>
<tr class="memitem:a24cb0b04cc2a1ec0cb11bbee57f9c4e8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a24cb0b04cc2a1ec0cb11bbee57f9c4e8"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>timed_lock</b> (const boost::system_time &amp;abs_time)</td></tr>
<tr class="memitem:a95440fce6c0e2abf94b3b3248017c058"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a95440fce6c0e2abf94b3b3248017c058"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>lock</b> ()</td></tr>
<tr class="memitem:a82a4205dcaeddb57ea80de771dcd8b07"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a82a4205dcaeddb57ea80de771dcd8b07"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>unlock</b> ()</td></tr>
<tr class="memitem:acab1fb7df65d01a7d8ed1abb19e2a264"><td class="memTemplParams" colspan="2"><a class="anchor" id="acab1fb7df65d01a7d8ed1abb19e2a264"></a>
template&lt;typename DurationType &gt; </td></tr>
<tr class="memitem:acab1fb7df65d01a7d8ed1abb19e2a264"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><b>timed_lock</b> (const DurationType &amp;rel_time)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>This mutex has an advantage over boost::mutex in that it does not involve any system calls, even in contention.</p>
<p>Uncontensted access is a simple compare and swap, no delay.</p>
<p>Contested access by different fibers in the same thread simply yields the thread until the lock is available. Actual delay is subject to the cooperative nature of other tasks in the fiber's thread.</p>
<p>Contested access by different threads requires a spin lock while the task is enqueued. Because the enqueue action is well-defined and 'short-lived' time spent 'spinning' should be minimal.</p>
<p>Cooperatively multi-tasked code must still worry about reentrancy. Suppose you have a thread sending a message across a socket, the socket members are thread safe, but the <code>write_message()</code> operation is not rentrant because the context could yield while waiting for a partial write to complete.</p>
<p>If while it has yielded another task in the same thread attempts to write a second message then you will get garbage out as both fibers take turns writing parts of their messages out of the socket.</p>
<p>Example problem: </p>
<div class="fragment"><pre class="fragment">    async(write_message);
    async(write_message);
    <span class="keywordtype">void</span> write_message() {
      sock-&gt;write(part1); <span class="comment">// may yield</span>
      sock-&gt;write(part2); <span class="comment">// may yield</span>
      sock-&gt;write(part3); <span class="comment">// may yield</span>
    }
</pre></div><p>The output could look something like:</p>
<div class="fragment"><pre class="fragment">    part1
    part2
    part1
    part3
    part2
    part3
</pre></div><p>What you want to happen is this:</p>
<div class="fragment"><pre class="fragment">    <span class="keywordtype">void</span> write_message() {
      boost::unique_lock&lt;cmt::mutex&gt; lock(sock-&gt;write_lock);
      sock-&gt;write(part1); <span class="comment">// may yield</span>
      sock-&gt;write(part2); <span class="comment">// may yield</span>
      sock-&gt;write(part3); <span class="comment">// may yield</span>
    }
</pre></div><p>Now if while writing the first message, someone attempts to write a second message second write will 'queue' behind the first by 'blocking' on the mutex.</p>
<p>As a result we now have to extend the normal discussion on thread-safe vs reentrant.</p>
<ul>
<li>prempt-thread-safe : the code may be called by multiple os threads at the same time.<ul>
<li>coop-thread-safe : the code may be called by multiple contexts within the same thread.</li>
<li>thread-unsafe : the code may only be called by one context at a time for a set of data.</li>
</ul>
</li>
</ul>
<p>In the example above, before we added the mutex the code was thread-unsafe After we added the mutex the code became coop-thread-safe, and potentially prempt-thread-safe</p>
<p>To be preempt-thread-safe any operations must be atomic or protected by a lock because the OS could switch you out between any two instructions.</p>
<p>To be coop-thread-safe all operations are 'atomic' unless they span a 'yield'. If they span a yield (such as writing parts of a message), then a mutex is required. </p>

<p>Definition at line <a class="el" href="mutex_8hpp_source.html#l00090">90</a> of file <a class="el" href="mutex_8hpp_source.html">mutex.hpp</a>.</p>
</div><hr/>The documentation for this class was generated from the following file:<ul>
<li>libs/cmt/include/mace/cmt/<a class="el" href="mutex_8hpp_source.html">mutex.hpp</a></li>
</ul>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Sat Jun 9 2012 02:18:54 for MACE by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
